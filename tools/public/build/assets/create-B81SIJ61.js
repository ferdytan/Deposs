import{r as u,j as e,m as se,a as ie,L as oe}from"./app-DS_U6FTt.js";import{c as le,B as h}from"./app-logo-icon-DGp3hhn2.js";import{D as ne,a as de,b as ce,c as me,d as pe}from"./dialog-CrSJXzBc.js";import{I as m}from"./input-BoUIE62w.js";import{L as n}from"./label-BVuRm3E6.js";import{S as ue,a as he,b as xe,c as ge,d as _e}from"./select-HCChz6OX.js";import{P as je}from"./index-BGtW6CPw.js";import{A as fe,X as ve}from"./app-layout-B3xwN8mX.js";import{O as be}from"./layout-DEUbyeni.js";import{D}from"./dropdown.esm-D1achfQ9.js";import{T as ye}from"./trash-2-C6nS2EgX.js";import{C as Ne}from"./circle-plus-Bs5dk7J_.js";/* empty css            */import"./index-Cf151ExV.js";import"./Combination-ByE_FHkl.js";import"./index-BvLh-YW8.js";import"./index-BuN6fwHd.js";var Ce="Separator",K="horizontal",Se=["horizontal","vertical"],B=u.forwardRef((x,v)=>{const{decorative:b,orientation:o=K,...d}=x,y=Oe(o)?o:K,p=b?{role:"none"}:{"aria-orientation":y==="vertical"?y:void 0,role:"separator"};return e.jsx(je.div,{"data-orientation":y,...p,...d,ref:v})});B.displayName=Ce;function Oe(x){return Se.includes(x)}var ke=B;function we({className:x,orientation:v="horizontal",decorative:b=!0,...o}){return e.jsx(ke,{"data-slot":"separator-root",decorative:b,orientation:v,className:le("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",x),...o})}function Je({customers:x,shippers:v,order_id:b}){const{data:o,setData:d,post:y,processing:N,errors:p}=se({customer_id:"",shipper_id:"",entry_date:"",eir_date:"",exit_date:"",commodity:"",no_aju:"",fumigasi:null,order_items:[{product_id:"",additional_product_ids:[],container_number:"",entry_date:"",eir_date:"",exit_date:"",commodity:"",country:""}]}),[_,$]=u.useState(!0),[C,U]=u.useState(b||"");u.useEffect(()=>{if(_&&!C){const a=new Date().toISOString().slice(0,10).replace(/-/g,"");U(`ORD-${a}-XXXX`)}},[_,C]);const z=()=>{d("order_items",[...o.order_items,{product_id:"",additional_product_ids:[],container_number:"",entry_date:"",eir_date:"",exit_date:"",commodity:"",country:"",vessel:""}])},F=a=>{d("order_items",o.order_items.filter((r,s)=>s!==a))},c=(a,r,s)=>{const i=[...o.order_items];if(i[a][r]=s,r==="price_type"){const l=A(i[a].product_id);let t;l&&(s==="20ft"?t=l.custom_price_20ft:s==="40ft"?t=l.custom_price_40ft:s==="global"&&(t=l.custom_global_price)),i[a].price_value=t;const j=i[a].additional_product_ids||[];i[a].additional_product_prices=E(j,s)}d("order_items",i)},H=a=>{const r=o.order_items[a].container_number;return o.order_items.some((s,i)=>i!==a&&s.container_number===r&&r.length>0)},V=a=>{if(a.preventDefault(),d("error",void 0),o.fumigasi&&o.fumigasi.trim()!==""&&!o.shipper_id){d("error","Shipper wajib diisi karena catatan Fumigator diisi.");return}y(route("orders.store"))},[J,S]=u.useState(!1),[k,I]=u.useState(null),[w,g]=u.useState([]),X=a=>{var s;I(a);const r=(s=o.order_items[a])==null?void 0:s.temperature;if(r&&Object.keys(r).length>0){const i=Object.entries(r).map(([l,t])=>({date:l,temps:t}));g(i)}else g([{date:new Date().toISOString().slice(0,10),temps:{}}]);S(!0)},q=(a,r)=>{g(s=>{const i=[...s];return i[a].date=r,i})},G=(a,r,s)=>{g(i=>{const l=[...i];return l[a].temps={...l[a].temps,[r.toString().padStart(2,"0")]:s},l})},W=()=>{g(a=>[...a,{date:"",temps:{}}])},Q=a=>{g(r=>r.filter((s,i)=>i!==a))},Y=()=>{if(k===null)return;const a={};w.forEach(s=>{s.date&&(a[s.date]=s.temps)});const r=[...o.order_items];r[k]={...r[k],temperature:a},d("order_items",r),S(!1),I(null),g([])},[O,L]=u.useState([]),[T,R]=u.useState(!1);u.useEffect(()=>{o.customer_id?(R(!0),ie.get(`/api/customers/${o.customer_id}/products`).then(a=>{L(a.data),d("order_items",o.order_items.map(r=>({...r,product_id:"",additional_product_ids:[],price_type:void 0})))}).finally(()=>R(!1))):(L([]),d("order_items",o.order_items.map(a=>({...a,product_id:"",additional_product_ids:[],price_type:void 0}))))},[o.customer_id]);const A=a=>O.find(r=>r.id===parseInt(a)),Z=(a,r)=>{const s=a.replace(/^order_items\.\d+\./,""),l={customer_id:"Customer",shipper_id:"Shipper",no_aju:"Nomor AJU",product_id:"Produk",container_number:"Nomor Kontainer",entry_date:"Tanggal Masuk",eir_date:"Tanggal EIR",exit_date:"Tanggal Keluar",commodity:"Komoditi",country:"Negara",vessel:"Nama Kapal",price_type:"Tipe Harga",additional_product_ids:"Produk Tambahan",temperature:"Rekam Suhu",order_items:"Item order"}[s]||s.split("_").join(" ").replace(/\b\w/g,j=>j.toUpperCase()),t=r.replace(/^The /,"").replace(/ for order items \d+$/,"").replace(/ in order items \d+$/,"").replace(/order_items\.\d+\./g,"").replace(/\.$/,"").trim();return`${l} ${t}`},E=(a,r)=>a.map(s=>{const i=O.find(t=>t.id.toString()===s);let l="0";return i&&(r==="20ft"?l=i.custom_price_20ft??"0":r==="40ft"?l=i.custom_price_40ft??"0":l=i.custom_global_price??"0"),`${s}:${l}`});return e.jsxs(fe,{children:[e.jsx(oe,{title:"Buat Order Baru"}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Buat Order Baru"}),Object.keys(p).length>0&&e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold text-red-800",children:"Terdapat kesalahan:"}),e.jsx("ul",{className:"list-inside list-disc space-y-1 text-sm text-red-700",children:Object.entries(p).map(([a,r])=>e.jsx("li",{children:Z(a,r)},a))})]}),o.error&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4",children:e.jsx("p",{className:"text-sm text-red-700",children:o.error})}),e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex rounded-md border p-1",children:[e.jsx("div",{onClick:()=>{$(!0),d("no_aju","")},className:`flex-1 cursor-pointer rounded-md p-2 text-center text-sm font-semibold transition-colors ${_?"bg-blue-500 text-white":"bg-transparent text-gray-700"}`,children:"Nomor Order Otomatis"}),e.jsx("div",{onClick:()=>$(!1),className:`flex-1 cursor-pointer rounded-md p-2 text-center text-sm font-semibold transition-colors ${_?"bg-transparent text-gray-700":"bg-blue-500 text-white"}`,children:"Nomor AJU"})]}),_?e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Nomor Order"}),e.jsx(m,{value:C,readOnly:!0,className:"cursor-not-allowed bg-gray-100"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Nomor AJU"}),e.jsx(m,{value:o.no_aju,onChange:a=>d("no_aju",a.target.value),placeholder:"Masukkan Nomor AJU",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Pilih Customer"}),e.jsx(D,{value:o.customer_id,options:x.map(a=>({label:a.name,value:a.id.toString()})),optionLabel:"label",optionValue:"value",placeholder:"Pilih atau cari Customer",filter:!0,filterPlaceholder:"Cari customer...",showClear:!1,onChange:a=>d("customer_id",a.value),className:"w-full rounded-md border border-gray-200 h-10 px-3 py-2"}),p.customer_id&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.customer_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Pilih Shipper"}),e.jsx(D,{value:o.shipper_id,options:v.map(a=>({label:a.name,value:a.id.toString()})),optionLabel:"label",optionValue:"value",placeholder:"Pilih atau cari Shipper",filter:!0,filterPlaceholder:"Cari shipper...",showClear:!0,onChange:a=>d("shipper_id",a.value),className:"w-full rounded-md border border-gray-200 h-10 px-3 py-2"}),p.shipper_id&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.shipper_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Fumigator (Catatan)"}),e.jsx("input",{value:o.fumigasi??"",onChange:a=>d("fumigasi",a.target.value),placeholder:"Masukkan catatan Fumigator (opsional)...",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",rows:3}),p.fumigasi&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.fumigasi})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{children:"Layanan & Nomor Kontainer"}),o.order_items.map((a,r)=>{const s=A(a.product_id),i=(s==null?void 0:s.requires_temperature)||!1,l=[{label:"Harga 20ft",value:"20ft",price:s==null?void 0:s.custom_price_20ft},{label:"Harga 40ft",value:"40ft",price:s==null?void 0:s.custom_price_40ft},{label:"Harga Global",value:"global",price:s==null?void 0:s.custom_global_price}].filter(t=>t.price!==void 0&&t.price!==null);return e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-4 rounded-lg border p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"min-w-[200px] flex-1",children:[e.jsxs(n,{children:["Produk #",r+1]}),e.jsx(D,{value:a.product_id,options:O.map(t=>({label:t.service_type,value:t.id.toString()})),optionLabel:"label",optionValue:"value",placeholder:T?"Memuat...":"Pilih Layanan",filter:!0,filterPlaceholder:"Cari layanan...",showClear:!1,onChange:t=>{c(r,"product_id",t.value),c(r,"price_type",void 0)},disabled:!o.customer_id||T,className:"w-full rounded-md border border-gray-200 h-10 px-3 py-2"})]}),e.jsxs("div",{className:"min-w-[160px] flex-1",children:[e.jsx(n,{children:"Pilih Harga"}),e.jsxs(ue,{value:a.price_type,onValueChange:t=>c(r,"price_type",t),disabled:!a.product_id||l.length===0,children:[e.jsx(he,{className:"h-10 px-3 py-2 font-sans",children:e.jsx(xe,{placeholder:"Pilih Harga"})}),e.jsx(ge,{children:l.map(t=>e.jsxs(_e,{value:t.value,children:[t.label," ",t.price?`: Rp${Number(t.price).toLocaleString()}`:""]},t.value))})]}),l.length===0&&e.jsx("div",{className:"mt-1 text-sm text-red-500",children:"Tidak ada harga untuk produk ini"})]}),e.jsxs("div",{className:"min-w-[200px] flex-1",children:[e.jsx(n,{children:"Additional Produk"}),e.jsx("div",{className:"max-h-32 min-h-10 overflow-y-auto rounded border px-2 py-1",children:O.map(t=>{var j;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:(j=a.additional_product_ids)==null?void 0:j.includes(t.id.toString()),onChange:ee=>{var M;const ae=ee.target.checked,P=t.id.toString();let f=((M=a.additional_product_ids)==null?void 0:M.slice())||[];ae?f.includes(P)||f.push(P):f=f.filter(te=>te!==P),c(r,"additional_product_ids",f);const re=E(f,a.price_type);c(r,"additional_product_prices",re)},disabled:T||!o.customer_id||t.id.toString()===a.product_id}),e.jsx("label",{children:t.service_type})]},t.id)})})]}),e.jsxs("div",{className:"min-w-[200px] flex-1",children:[e.jsx(n,{children:"Nomor Kontainer"}),e.jsx(m,{value:a.container_number,onChange:t=>c(r,"container_number",t.target.value.toUpperCase()),placeholder:"EMCU1234567",maxLength:11}),H(r)&&e.jsx("p",{className:"text-sm text-red-500",children:"Nomor kontainer sudah dipakai"})]}),i&&e.jsx("div",{className:"flex items-end",children:e.jsx(h,{type:"button",variant:"outline",onClick:()=>X(r),children:"Rekam Suhu"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Negara"}),e.jsx(m,{value:a.country,onChange:t=>c(r,"country",t.target.value),placeholder:"Negara Asal / tujuan"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Nama Kapal (Vessel)"}),e.jsx(m,{value:a.vessel||"",onChange:t=>c(r,"vessel",t.target.value),placeholder:"Nama Kapal"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Tanggal Masuk"}),e.jsx(m,{type:"datetime-local",value:a.entry_date,onChange:t=>c(r,"entry_date",t.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Tanggal EIR"}),e.jsx(m,{type:"datetime-local",value:a.eir_date,onChange:t=>c(r,"eir_date",t.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Tanggal Keluar"}),e.jsx(m,{type:"datetime-local",value:a.exit_date,onChange:t=>c(r,"exit_date",t.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Komoditi"}),e.jsx(m,{value:a.commodity,onChange:t=>c(r,"commodity",t.target.value),placeholder:"Contoh: Barang Elektronik"})]})]}),o.order_items.length>1&&e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{type:"button",variant:"destructive",size:"icon",onClick:()=>F(r),children:e.jsx(ye,{className:"h-4 w-4"})})})]},r),e.jsx(we,{className:"my-6"})]})}),e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:z,children:"+ Tambah Layanan"})]}),_&&e.jsx("input",{type:"hidden",name:"order_id",value:C}),e.jsx("input",{type:"hidden",name:"order_items",value:JSON.stringify(o.order_items)}),e.jsx(ne,{open:J,onOpenChange:S,children:e.jsxs(de,{className:"max-w-3xl",children:[e.jsx(ce,{children:e.jsx(me,{children:"Rekam Suhu Kontainer"})}),e.jsxs("div",{className:"max-h-[60vh] space-y-6 overflow-y-auto pr-2",children:[w.map((a,r)=>e.jsxs("div",{className:"space-y-2 rounded border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{htmlFor:`date_${r}`,children:"Tanggal"}),e.jsx(m,{id:`date_${r}`,type:"date",value:a.date,onChange:s=>q(r,s.target.value),className:"max-w-[180px]"}),w.length>1&&e.jsx(h,{type:"button",size:"icon",variant:"destructive",className:"ml-auto",onClick:()=>Q(r),children:e.jsx(ve,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"grid max-h-64 grid-cols-2 gap-2 overflow-y-auto",children:[...Array(24)].map((s,i)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{htmlFor:`temp_${r}_${i}`,children:[i.toString().padStart(2,"0"),":00"]}),e.jsx(m,{id:`temp_${r}_${i}`,type:"number",step:"0.1",value:a.temps[i.toString().padStart(2,"0")]||"",onChange:l=>G(r,i,l.target.value),className:"w-24"})]},i))})]},r)),e.jsxs(h,{type:"button",variant:"outline",onClick:W,className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"})," Tambah Tanggal"]})]}),e.jsxs(pe,{className:"gap-2",children:[e.jsx(h,{variant:"outline",onClick:()=>S(!1),children:"Batal"}),e.jsx(h,{onClick:Y,children:"Simpan"})]})]})}),e.jsxs(h,{type:"submit",disabled:N,className:"w-full sm:w-auto",children:[N&&e.jsx("span",{className:"mr-2 animate-spin",children:"●"}),N?"Memproses...":"Buat Order"]})]})]})})]})}export{Je as default};
