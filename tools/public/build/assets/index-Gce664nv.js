import{r as l,K as Je,j as e,L as Ge,$ as T,S as c}from"./app-BIxiM4zi.js";import{A as Xe,T as Ye,X as Qe}from"./app-layout-CGJByD3C.js";import{O as Ve}from"./layout-DwptL-Gm.js";import{D as We,a as Ze,b as es,c as ss,d as ts}from"./dialog-C_P-TstP.js";import{H as as}from"./heading-CGEw6JNV.js";import{A as M,a as R,b as P,c as F,d as rs,e as $,f as L,g as H}from"./alert-dialog-B2irFhXF.js";import{a as Z,B as d}from"./app-logo-icon-pQ4BnCQP.js";import{I as g}from"./input-LkNi3APd.js";import{L as y}from"./label-B1m0EZ8G.js";import{T as ns,a as ls,b as B,c as h,d as is,e as o}from"./table-TKJd9Ewa.js";import{a as Ne,A as ye,b as os}from"./arrow-up-rezICMfo.js";import{P as q}from"./pencil-BPAPi1ez.js";import{T as cs}from"./trash-2-BY3vKzZB.js";import{C as ds}from"./circle-plus-CUCk_ba0.js";/* empty css            */import"./index-DinVnDuX.js";import"./Combination-C89aHk2d.js";import"./index-B-YrhCAK.js";import"./index-BFHFZXKF.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],be=Z("Eye",hs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],V=Z("Plus",ms);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],xs=Z("RotateCcw",us),ps=[{title:"Order Management",href:"/orders"}];function W(j){if(!j)return"-";const u=new Date(j);if(isNaN(u.getTime()))return"-";const i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],C=u.getDate().toString().padStart(2,"0"),U=i[u.getMonth()],z=u.getFullYear(),b=u.getHours().toString().padStart(2,"0"),f=u.getMinutes().toString().padStart(2,"0");return`${C} ${U} ${z}, ${b}:${f}`}function Rs({orders:j,filters:u}){var de,he,me;const i=u||{},[C,U]=l.useState((i==null?void 0:i.search)??""),[z,b]=l.useState(!1),[f,ee]=l.useState(""),[x,ve]=l.useState(!!i.trashed),[Se,k]=l.useState(!1),[se,te]=l.useState(null),[K,p]=l.useState([]),[De,Te]=l.useState({}),Ce=s=>{if(console.log("DATA ORDER:",s),console.log("TEMPERATURE:",s.temperature),te(s),s.temperature&&Object.keys(s.temperature).length>0){const t=Object.entries(s.temperature).map(([r,n])=>({date:r,temps:n||{}}));p(t)}else p([{date:new Date().toISOString().slice(0,10),temps:{}}]);k(!0)},ke=(s,t)=>{p(r=>{const n=[...r];return n[s].date=t,n})},we=(s,t,r)=>{p(n=>{const m=[...n];return m[s].temps={...m[s].temps||{},[t.toString().padStart(2,"0")]:r},m})},_e=()=>{p(s=>[...s,{date:"",temps:{}}])},Ee=s=>{p(t=>t.filter((r,n)=>n!==s))},Oe=()=>{if(!se)return;const s={};K.forEach(t=>{t.date&&(s[t.date]=t.temps)}),console.log("Data yang dikirim ke backend:",s),c.patch(route("orders.update-temperature",se.id),{temperature:s},{onSuccess:()=>{k(!1),te(null),p([]),c.reload({only:["orders"]})},onError:t=>{alert("Terjadi error saat menyimpan data suhu."),console.error(t)}})},{props:J}=Je(),N=(he=(de=J.auth)==null?void 0:de.user)==null?void 0:he.role_id,ae=()=>{c.get("/orders",{search:C,trashed:i.trashed})},[Ae,v]=l.useState(!1),[w,G]=l.useState(""),[re,ne]=l.useState(null),Ie=s=>{ne(s),G(""),v(!0)},Me=(s,t)=>{ne(s);const r=t?new Date(t).toISOString().slice(0,16):"";G(r),v(!0)},Re=()=>{!re||!w||c.patch(route("orders.update-entry",re),{entry_date:w},{onSuccess:()=>{v(!1),c.reload({only:["orders"]})}})},[Pe,S]=l.useState(!1),[_,X]=l.useState(""),[E,le]=l.useState(null),[Fe,D]=l.useState(!1),[O,Y]=l.useState(""),[ie,oe]=l.useState(null),$e=s=>{oe(s),Y(""),D(!0)},Le=(s,t)=>{oe(s);const r=t?new Date(t).toISOString().slice(0,16):"";Y(r),D(!0)},He=()=>{!ie||!O||c.patch(route("orders.update-exit",ie),{exit_date:O},{onSuccess:()=>{D(!1)}})},Be=s=>{le(s),X(""),S(!0)},qe=(s,t)=>{le(s);const r=t?new Date(t).toISOString().slice(0,16):"";X(r),S(!0)},Ue=()=>{!E||!_||c.patch(route("orders.update-eir",E),{eir_date:_},{onSuccess:()=>{S(!1)}})},Q=({label:s,field:t,currentSort:r,currentDir:n})=>{const m=r===t&&n==="asc"?"desc":"asc";return e.jsxs(T,{href:route("orders.index",{sort_by:t,sort_dir:m,trashed:i.trashed,search:i.search}),className:"flex items-center gap-1 font-semibold text-gray-700 hover:text-black",children:[s,r===t?m==="asc"?e.jsx(ye,{className:"h-4 w-4"}):e.jsx(Ne,{className:"h-4 w-4"}):e.jsx(os,{className:"h-4 w-4 text-gray-400"})]})},ze=()=>{E!==null&&f.trim()&&c.delete(route("orders.destroy",E),{data:{reason:f},onSuccess:()=>{b(!1),ee("")}})},Ke=()=>{const s=!x;ve(s),c.get("/orders",{trashed:s?"1":void 0})},ce=[],A={};for(const s of j.data){const t=s.no_aju??s.order_id;A[t]||(A[t]=[],ce.push(t)),A[t].push(s)}return e.jsxs(Xe,{breadcrumbs:ps,children:[e.jsx(Ge,{title:"Order Management"}),e.jsxs(Ve,{children:[e.jsxs("div",{className:"space-y-6",children:[((me=J.flash)==null?void 0:me.success)&&e.jsx("div",{className:"rounded-md bg-green-50 p-4 text-sm text-green-700",children:J.flash.success}),e.jsx(as,{title:"Order List",description:"Manage all registered orders and their statuses."}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(d,{variant:"outline",onClick:Ke,children:x?"Sembunyikan Order Dihapus":"Tampilkan Order Dihapus"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx(g,{id:"search",placeholder:"Search by customer, product, or container",value:C,onChange:s=>U(s.target.value),onKeyUp:s=>s.key==="Enter"&&ae(),className:"flex-1"}),e.jsx(d,{onClick:ae,className:"w-full sm:w-auto",children:"Search"})]})]}),e.jsx("div",{className:"flex justify-end",children:N!=3&&e.jsx(d,{asChild:!0,className:"mb-2",children:e.jsx(T,{href:"/orders/create",children:"+ Create Orders"})})}),e.jsx("div",{className:"w-full overflow-x-auto rounded-md border",children:e.jsxs(ns,{children:[e.jsx(ls,{children:e.jsxs(B,{children:[e.jsx(h,{children:e.jsx(Q,{label:"Nama Customer",field:"customers.name",currentSort:i.sort_by,currentDir:i.sort_dir})}),e.jsx(h,{children:e.jsx(Q,{label:"Produk",field:"products.service_type",currentSort:i.sort_by,currentDir:i.sort_dir})}),e.jsx(h,{children:e.jsx(Q,{label:"Nomor Kontainer",field:"container_number",currentSort:i.sort_by,currentDir:i.sort_dir})}),e.jsx(h,{children:"Size"}),e.jsx(h,{children:"Tanggal Masuk"}),e.jsx(h,{children:"Tanggal EIR"}),e.jsx(h,{children:"Tanggal Keluar"}),e.jsx(h,{children:"Komoditi"}),e.jsx(h,{children:"Temperatur"}),e.jsx(h,{children:"Fumigator"}),x&&e.jsx(h,{children:"Alasan Dihapus"}),e.jsx(h,{className:"text-right",children:"Action"})]})}),e.jsx(is,{children:j.data.length===0?e.jsx(B,{children:e.jsx(o,{colSpan:x?11:10,className:"py-8 text-center text-sm text-muted-foreground",children:"No orders found."})}):ce.map(s=>{var m,ue;const t=A[s],r=t[0],n=!!De[s];return e.jsxs(l.Fragment,{children:[e.jsx(B,{className:"cursor-pointer bg-gray-100 hover:bg-gray-200",onClick:()=>Te(a=>({...a,[s]:!a[s]})),children:e.jsxs(o,{colSpan:x?11:10,className:"flex items-center justify-between py-3 font-semibold",children:[e.jsxs("div",{className:"mr-3",children:["Nomor Order: ",((m=r.order)==null?void 0:m.order_id)??r.order_id," / No. AJU:"," ",r.no_aju??"-",n?e.jsx(Ne,{className:"ml-2 inline h-4 w-4"}):e.jsx(ye,{className:"ml-2 inline h-4 w-4"})]}),e.jsx("div",{className:"flex gap-3",children:x?e.jsxs(d,{size:"sm",variant:"outline",onClick:a=>{a.stopPropagation(),c.post(route("orders.restore",r.id),{},{onSuccess:()=>{c.get(route("orders.index"),{trashed:!0})},preserveScroll:!0})},className:"inline-flex items-center gap-1",title:"Pulihkan Order",children:[e.jsx(xs,{className:"h-4 w-4"}),"Pulihkan"]}):e.jsxs(e.Fragment,{children:[N!=3&&e.jsx(T,{href:route("orders.show",((ue=r.order)==null?void 0:ue.id)??r.order_id),title:"Lihat Detail Order",onClick:a=>a.stopPropagation(),children:e.jsx(be,{className:"h-4 w-4 text-gray-500 hover:text-gray-700"})}),N!=3&&e.jsx(T,{href:route("orders.edit",r.order.id),title:"Edit Order",onClick:a=>a.stopPropagation(),children:e.jsx(q,{className:"h-4 w-4 text-blue-500 hover:text-blue-700"})})]})})]})}),!n&&t.map(a=>{var xe,pe,ge,je,fe;return e.jsxs(B,{className:"group",children:[e.jsx(o,{className:"py-3 font-medium",children:((pe=(xe=a.order)==null?void 0:xe.customer)==null?void 0:pe.name)??"-"}),e.jsx(o,{className:"py-3",children:((ge=a.product)==null?void 0:ge.service_type)??"-"}),e.jsx(o,{className:"py-3",children:a.container_number}),e.jsx(o,{className:"py-3",children:a.price_type??"-"}),e.jsx(o,{className:"py-3",children:a.entry_date?e.jsxs("button",{onClick:()=>Me(a.id,a.entry_date??""),className:"flex items-center gap-1 hover:underline",children:[W(a.entry_date),e.jsx(q,{className:"h-4 w-4 text-blue-500"})]}):e.jsxs("button",{onClick:()=>Ie(a.id),className:"flex items-center gap-1 hover:underline",children:["Tambah",e.jsx(V,{className:"h-4 w-4 text-green-500"})]})}),e.jsx(o,{className:"py-3",children:N!=3&&e.jsx(e.Fragment,{children:a.eir_date?e.jsxs("button",{onClick:()=>qe(a.id,a.eir_date??""),className:"flex items-center gap-1 hover:underline",children:[W(a.eir_date),e.jsx(q,{className:"h-4 w-4 text-blue-500"})]}):e.jsxs("button",{onClick:()=>Be(a.id),className:"flex items-center gap-1 hover:underline",children:["Tambah",e.jsx(V,{className:"h-4 w-4 text-green-500"})]})})}),e.jsx(o,{className:"py-3",children:N!=3&&e.jsx(e.Fragment,{children:a.exit_date?e.jsxs("button",{onClick:()=>Le(a.id,a.exit_date??""),className:"flex items-center gap-1 hover:underline",children:[W(a.exit_date),e.jsx(q,{className:"h-4 w-4 text-blue-500"})]}):e.jsxs("button",{onClick:()=>$e(a.id),className:"flex items-center gap-1 hover:underline",children:["Tambah",e.jsx(V,{className:"h-4 w-4 text-green-500"})]})})}),e.jsx(o,{className:"py-3",children:a.commodity??"-"}),e.jsx(o,{className:"py-3 text-center",children:String((je=a.product)==null?void 0:je.requires_temperature)==="1"&&e.jsx(d,{size:"icon",variant:"ghost",onClick:()=>Ce(a),title:"Edit Rekam Suhu",className:"cursor-pointer",children:e.jsx(Ye,{className:"h-4 w-4 cursor-pointer text-orange-500"})})}),e.jsx(o,{className:"py-3",children:(fe=a.order)!=null&&fe.fumigasi?a.order.fumigasi:"-"}),x&&e.jsx(o,{className:"py-3 text-red-600",children:a.deleted_reason??"-"}),e.jsx(o,{className:"text-right",children:!x&&N!=3&&e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(d,{size:"icon",variant:"ghost",asChild:!0,title:"Lihat Detail",children:e.jsx(T,{href:route("orders.items.simple.show",r.id),title:"Lihat Order Item Pertama",onClick:I=>I.stopPropagation(),children:e.jsx(be,{className:"h-4 w-4 text-gray-500 hover:text-gray-700"})})}),e.jsx(d,{size:"icon",variant:"ghost",onClick:()=>{const I=prompt("Masukkan alasan hapus kontainer:");I&&c.delete(route("order-items.destroy",a.id),{data:{delete_reason:I}})},title:"Hapus",className:"cursor-pointer text-red-500 hover:bg-red-100",children:e.jsx(cs,{className:"h-4 w-4"})})]})})]},a.id)})]},s)})})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:j.links.map((s,t)=>s.url?e.jsx(d,{variant:s.active?"default":"outline",disabled:!s.url,onClick:()=>c.get(s.url),className:"px-3 py-1 whitespace-nowrap",children:s.label.replace(/&laquo; Previous|Next &raquo;/,r=>r.includes("Previous")?"← Prev":r.includes("Next")?"Next →":r)},t):e.jsx("span",{className:"px-3 py-1",children:"..."},t))})]}),e.jsx(M,{open:z,onOpenChange:b,children:e.jsxs(R,{children:[e.jsxs(P,{children:[e.jsx(F,{children:"Hapus Order"}),e.jsx(rs,{children:"Masukkan alasan penghapusan order ini:"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(g,{placeholder:"Alasan penghapusan",value:f,onChange:s=>ee(s.target.value),required:!0})}),e.jsxs($,{children:[e.jsx(L,{onClick:()=>b(!1),children:"Batal"}),e.jsx(H,{disabled:!f.trim(),onClick:ze,className:"bg-red-600 hover:bg-red-700",children:"Hapus Order"})]})]})}),e.jsx(M,{open:Pe,onOpenChange:S,children:e.jsxs(R,{children:[e.jsx(P,{children:e.jsx(F,{children:_?"Edit Tanggal EIR":"Tambah Tanggal EIR"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{htmlFor:"eir-date",children:"Tanggal EIR"}),e.jsx(g,{id:"eir-date",type:"datetime-local",value:_,onChange:s=>X(s.target.value),required:!0})]}),e.jsxs($,{children:[e.jsx(L,{onClick:()=>S(!1),children:"Batal"}),e.jsx(H,{onClick:Ue,className:"bg-blue-600 hover:bg-blue-700",children:"Simpan"})]})]})}),e.jsx(M,{open:Fe,onOpenChange:D,children:e.jsxs(R,{children:[e.jsx(P,{children:e.jsx(F,{children:O?"Edit Tanggal Keluar":"Tambah Tanggal Keluar"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{htmlFor:"exit-date",children:"Tanggal Keluar"}),e.jsx(g,{id:"exit-date",type:"datetime-local",value:O,onChange:s=>Y(s.target.value),required:!0})]}),e.jsxs($,{children:[e.jsx(L,{onClick:()=>D(!1),children:"Batal"}),e.jsx(H,{onClick:He,className:"bg-blue-600 hover:bg-blue-700",children:"Simpan"})]})]})}),e.jsx(M,{open:Ae,onOpenChange:v,children:e.jsxs(R,{children:[e.jsx(P,{children:e.jsx(F,{children:w?"Edit Tanggal Masuk":"Tambah Tanggal Masuk"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{htmlFor:"entry-date",children:"Tanggal Masuk"}),e.jsx(g,{id:"entry-date",type:"datetime-local",value:w,onChange:s=>G(s.target.value),required:!0})]}),e.jsxs($,{children:[e.jsx(L,{onClick:()=>v(!1),children:"Batal"}),e.jsx(H,{onClick:Re,className:"bg-blue-600 hover:bg-blue-700",children:"Simpan"})]})]})}),e.jsx(We,{open:Se,onOpenChange:k,children:e.jsxs(Ze,{className:"max-w-3xl",children:[e.jsx(es,{children:e.jsx(ss,{children:"Rekam Suhu Kontainer"})}),e.jsxs("div",{className:"max-h-[60vh] space-y-6 overflow-y-auto pr-2",children:[K.map((s,t)=>e.jsxs("div",{className:"space-y-2 rounded border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{htmlFor:`date_${t}`,children:"Tanggal"}),e.jsx(g,{id:`date_${t}`,type:"date",value:s.date,onChange:r=>ke(t,r.target.value),className:"max-w-[180px]"}),K.length>1&&e.jsx(d,{type:"button",size:"icon",variant:"destructive",className:"ml-auto",onClick:()=>Ee(t),children:e.jsx(Qe,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"grid max-h-64 grid-cols-2 gap-2 overflow-y-auto",children:[...Array(24)].map((r,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{htmlFor:`temp_${t}_${n}`,children:[n.toString().padStart(2,"0"),":00"]}),e.jsx(g,{id:`temp_${t}_${n}`,type:"number",step:"0.1",value:s.temps[n.toString().padStart(2,"0")]||"",onChange:m=>we(t,n,m.target.value),className:"w-24"})]},n))})]},t)),e.jsxs(d,{type:"button",variant:"outline",onClick:_e,className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4"})," Tambah Tanggal"]})]}),e.jsxs(ts,{className:"gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>k(!1),children:"Batal"}),e.jsx(d,{onClick:Oe,children:"Simpan"})]})]})})]})]})}export{Rs as default};
